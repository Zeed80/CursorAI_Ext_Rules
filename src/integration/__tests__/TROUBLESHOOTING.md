# Устранение неполадок интеграционных тестов

## Проблема: Тест возвращает пустой массив моделей

Если интеграционный тест возвращает пустой массив (0 моделей), возможны следующие причины:

### 1. Неверный API ключ

**Симптомы:**
- Тест возвращает пустой массив
- В логах может быть ошибка 401 (Unauthorized)

**Решение:**
- Проверьте, что API ключ установлен правильно: `echo $env:CURSOR_API_KEY` (PowerShell) или `echo $CURSOR_API_KEY` (bash)
- Убедитесь, что ключ не содержит пробелов или лишних символов
- Проверьте, что ключ действителен и не истек

### 2. API endpoint недоступен

**Симптомы:**
- В логах ошибка сети или таймаут
- Тест падает с ошибкой соединения

**Решение:**
- Проверьте интернет-соединение
- Убедитесь, что `https://api.cursor.com` доступен
- Проверьте, нет ли firewall или прокси, блокирующего запросы

### 3. Неправильный формат ответа API

**Симптомы:**
- В логах видно, что запрос выполнен, но массив пуст
- Может быть сообщение об ошибке парсинга

**Решение:**
- API может изменить формат ответа
- Проверьте актуальную документацию API
- Посмотрите на логи в консоли для деталей

### 4. Все модели отфильтрованы

**Симптомы:**
- В логах может быть сообщение о том, что модели найдены, но результат пуст

**Решение:**
- Проверьте, что фильтр GitHub Copilot не удаляет все модели
- Посмотрите на логи для количества найденных моделей до фильтрации

## Как включить подробное логирование

Добавьте в тест перед вызовом `getModelsViaAPI()`:

```typescript
// Временно включите все логи
const originalLog = console.log;
const originalError = console.error;
console.log = (...args: any[]) => originalLog(...args);
console.error = (...args: any[]) => originalError(...args);
```

Или запустите тесты с выводом всех логов:

```bash
npm run test:api -- --verbose
```

## Проверка API ключа вручную

Вы можете проверить API ключ вручную с помощью curl:

```bash
# Linux/Mac
curl -u YOUR_API_KEY: https://api.cursor.com/v0/models

# Windows (PowerShell)
$headers = @{ Authorization = "Basic " + [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes("YOUR_API_KEY:")) }
Invoke-RestMethod -Uri "https://api.cursor.com/v0/models" -Headers $headers
```

Если запрос возвращает список моделей, значит ключ правильный.

## Проверка работы API

Вы также можете проверить доступность API:

```bash
# Проверка доступности
curl -I https://api.cursor.com/v0/models

# Должен вернуть статус 401 (Unauthorized), что означает, что endpoint доступен
```
