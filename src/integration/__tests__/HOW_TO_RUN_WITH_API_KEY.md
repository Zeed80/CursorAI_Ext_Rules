# Как запустить тесты с реальным API ключом

Интеграционные тесты автоматически используют переменную окружения `CURSOR_API_KEY` для подключения к реальному API.

## Способ 1: Переменная окружения (рекомендуется)

### Windows (PowerShell)

```powershell
# Установить переменную окружения
$env:CURSOR_API_KEY="your-api-key-here"

# Запустить тесты
npm run test:api
```

### Windows (Command Prompt)

```cmd
# Установить переменную окружения
set CURSOR_API_KEY=your-api-key-here

# Запустить тесты
npm run test:api
```

### Linux / macOS

```bash
# Установить переменную окружения
export CURSOR_API_KEY="your-api-key-here"

# Запустить тесты
npm run test:api
```

### Linux / macOS (одной командой)

```bash
CURSOR_API_KEY="your-api-key-here" npm run test:api
```

## Способ 2: Файл .env (альтернативный)

Если хотите хранить ключ в файле `.env`:

1. Установите пакет `dotenv`:
```bash
npm install --save-dev dotenv
```

2. Создайте файл `.env` в корне проекта:
```
CURSOR_API_KEY=your-api-key-here
```

3. Добавьте `.env` в `.gitignore` (чтобы не коммитить ключ)

4. Обновите `jest.config.js`:
```javascript
module.exports = {
  // ... существующая конфигурация
  setupFiles: ['<rootDir>/src/integration/__tests__/setup-env.ts'],
};
```

5. Создайте `src/integration/__tests__/setup-env.ts`:
```typescript
import { config } from 'dotenv';
config();
```

## Какие тесты будут запущены?

С API ключом будут запущены **2 интеграционных теста**:

1. ✅ `должен получить реальный список моделей от API`
   - Подключается к реальному API
   - Проверяет, что получен список моделей
   - Проверяет структуру моделей

2. ✅ `должен получить модели из формата согласно документации`
   - Проверяет формат ответа согласно документации
   - Валидирует структуру данных

**Без API ключа** эти тесты автоматически пропускаются (skipped), что видно в выводе:

```
Интеграционные тесты (требуют реальный API ключ)
  ○ skipped должен получить реальный список моделей от API
  ○ skipped должен получить модели из формата согласно документации
```

**С API ключом** они будут выполнены:

```
Интеграционные тесты (требуют реальный API ключ)
  √ должен получить реальный список моделей от API (5234 ms)
  √ должен получить модели из формата согласно документации (2341 ms)
```

## Важно

⚠️ **Безопасность**: Никогда не коммитьте API ключ в Git!

- Используйте переменные окружения
- Добавьте `.env` в `.gitignore`
- Не храните ключи в коде

## Пример вывода с API ключом

```
PASS src/integration/__tests__/cursor-api-models.test.ts
  CursorAPI - Получение списка моделей
    Успешное получение списка моделей
      √ должен получить список моделей через /v0/models endpoint
      √ должен использовать Basic Auth для v0 API
      √ должен правильно преобразовывать список строк моделей в массив CursorModel
      √ должен исключать модели GitHub Copilot из списка
    Обработка ошибок
      √ должен вернуть пустой массив при ошибке 401 (Unauthorized)
      √ должен вернуть пустой массив при ошибке 403 (Forbidden)
      √ должен вернуть пустой массив при ошибке сети
      √ должен вернуть пустой массив при неверном формате ответа
      √ должен вернуть пустой массив при пустом списке моделей
    Работа без API ключа
      √ должен вернуть пустой массив если API ключ не установлен
    Формат запроса
      √ должен использовать правильный URL для v0 API
      √ должен устанавливать правильные заголовки
    Интеграционные тесты (требуют реальный API ключ)
      √ должен получить реальный список моделей от API (5234 ms)
      √ должен получить модели из формата согласно документации (2341 ms)

Test Suites: 1 passed, 1 total
Tests:       14 passed, 14 total  ← Все тесты выполнены!
Time:        7.8 s
```
