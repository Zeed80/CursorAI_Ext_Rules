# –î–µ—Ç–∞–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CursorAI

## 1. UI –¥–ª—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –≤ Explorer
```
[–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ —Ñ–∞–π–ª–µ/–ø–∞–ø–∫–µ]
‚îú‚îÄ ü§ñ CursorAI Autonomous
   ‚îú‚îÄ ‚ö° –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
   ‚îú‚îÄ üî• –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å —Ñ–∞–π–ª (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   ‚îú‚îÄ üìù –£–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (—Å—Ä–µ–¥–Ω–∏–π)
   ‚îú‚îÄ üß™ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã (–Ω–∏–∑–∫–∏–π)
   ‚îú‚îÄ üí° –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏—è
   ‚îî‚îÄ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–¥–∞—á—É...
```

### Command Palette
```
> CursorAI Autonomous: Create Task...
  [–í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–¥–∞—á–∏]
  [–í—ã–±–æ—Ä –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ | –í—ã—Å–æ–∫–∏–π | –°—Ä–µ–¥–Ω–∏–π | –ù–∏–∑–∫–∏–π]
  [–í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞: Auto | Backend | Frontend | Architect | QA | DevOps]
  [–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É]
```

### Status Bar
```
[ü§ñ –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã: 3 –∑–∞–¥–∞—á–∏ | Backend —Ä–∞–±–æ—Ç–∞–µ—Ç | üí∞ $0.15]
  ‚Üì –∫–ª–∏–∫
  [–ü–∞–Ω–µ–ª—å –∑–∞–¥–∞—á]
  ‚îú‚îÄ –í –ø—Ä–æ—Ü–µ—Å—Å–µ (2):
  ‚îÇ  ‚îú‚îÄ ‚ö° –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ –≤ auth.ts (Backend) - 45%
  ‚îÇ  ‚îî‚îÄ üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (Architect) - 20%
  ‚îú‚îÄ –í –æ—á–µ—Ä–µ–¥–∏ (1):
  ‚îÇ  ‚îî‚îÄ üß™ –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã (QA)
  ‚îî‚îÄ [+ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞]
```

### Notifications
```
[–í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ü§ñ Backend Agent                          ‚îÇ
‚îÇ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è "–ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥"   ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ –ò–∑–º–µ–Ω–µ–Ω–∏—è:                                ‚îÇ
‚îÇ - src/auth.ts (15 —Å—Ç—Ä–æ–∫)                 ‚îÇ
‚îÇ - src/middleware.ts (8 —Å—Ç—Ä–æ–∫)            ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 85%                          ‚îÇ
‚îÇ –ó–∞—Ç—Ä–∞—Ç—ã: $0.02 (–ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)        ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ [–ü—Ä–∏–Ω—è—Ç—å] [–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å] [–û—Ç–∫–ª–æ–Ω–∏—Ç—å]      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CursorAI

### –°—Ö–µ–º–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏

```mermaid
graph TB
    Task[–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞] --> Complexity[–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏]
    
    Complexity -->|–ü—Ä–æ—Å—Ç–∞—è| Local[–õ–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å<br/>Ollama/LLM Studio<br/>–ë–ï–°–ü–õ–ê–¢–ù–û]
    Complexity -->|–°—Ä–µ–¥–Ω—è—è| Cloud[–û–±–ª–∞—á–Ω–∞—è API<br/>OpenAI/Google<br/>~$0.01-0.05]
    Complexity -->|–°–ª–æ–∂–Ω–∞—è| Decision{–¢–∏–ø –∑–∞–¥–∞—á–∏?}
    
    Decision -->|–ê–Ω–∞–ª–∏–∑/–†–∞–∑–º—ã—à–ª–µ–Ω–∏–µ| Cloud
    Decision -->|–ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏–π| CursorChat[CursorAI Chat<br/>Pro –ø–ª–∞–Ω]
    Decision -->|–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤| CursorComp[CursorAI Composer<br/>Pro –ø–ª–∞–Ω]
    Decision -->|–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥| CursorComp
    
    Local --> Result[–†–µ–∑—É–ª—å—Ç–∞—Ç]
    Cloud --> Result
    CursorChat --> Result
    CursorComp --> Result
```

### –ü—Ä–∏–º–µ—Ä –ø–æ—Ç–æ–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CursorAI

```mermaid
sequenceDiagram
    participant U as User
    participant W as AgentWorker
    participant L as LocalModel
    participant C as CloudAPI
    participant CC as CursorAI
    participant F as Files

    U->>W: –ó–∞–¥–∞—á–∞ "–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å auth.ts"
    W->>W: –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –í–´–°–û–ö–ê–Ø
    
    Note over W,L: –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ (–ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)
    W->>L: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª
    L->>W: –ü—Ä–æ–±–ª–µ–º—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    
    Note over W,C: –≠—Ç–∞–ø 2: –†–µ—à–µ–Ω–∏–µ (–æ–±–ª–∞—á–Ω–∞—è API)
    W->>C: –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
    C->>W: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω
    
    Note over W,CC: –≠—Ç–∞–ø 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (CursorAI Composer)
    W->>CC: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Composer
    CC->>F: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
    F->>W: –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
    
    W->>U: ‚úÖ –ì–æ—Ç–æ–≤–æ! –ó–∞—Ç—Ä–∞—Ç—ã: $0.08
    Note over W,U: –õ–æ–∫–∞–ª—å–Ω–∞—è: $0<br/>–û–±–ª–∞—á–Ω–∞—è: $0.03<br/>CursorAI: $0.05 (Pro –ø–ª–∞–Ω)
```

## 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CursorAI API

### CursorAI Chat API (–¥–ª—è –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏)
```typescript
// src/integration/cursor-chat-integration.ts
export class CursorChatIntegration {
    /**
     * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CursorAI Chat –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏–π
     */
    async consolidateSolutions(
        task: Task,
        solutions: AgentSolution[]
    ): Promise<ConsolidatedSolution> {
        // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è CursorAI Chat
        const prompt = this.buildConsolidationPrompt(task, solutions);
        
        // –í—ã–∑—ã–≤–∞–µ–º CursorAI Chat —á–µ—Ä–µ–∑ API
        const response = await CursorAPI.sendChatMessage(prompt, {
            model: 'auto', // CursorAI —Å–∞–º –≤—ã–±–µ—Ä–µ—Ç –ª—É—á—à—É—é –º–æ–¥–µ–ª—å
            useComposer: false
        });
        
        return this.parseConsolidatedSolution(response);
    }
}
```

### CursorAI Composer API (–¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤)
```typescript
// src/integration/cursor-composer-integration.ts
export class CursorComposerIntegration {
    /**
     * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CursorAI Composer –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
     */
    async applyChanges(
        files: FileChange[],
        description: string
    ): Promise<ComposerResult> {
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º Composer —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
        const composerSession = await CursorAPI.openComposer({
            description,
            files,
            autoApply: false // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
        });
        
        // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Composer
        return await composerSession.waitForCompletion();
    }
}
```

### CursorAI Tab (–¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –∞–≥–µ–Ω—Ç–∞—Ö)
```typescript
// src/integration/cursor-tab-integration.ts
export class CursorTabIntegration {
    /**
     * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CursorAI Tab –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
     */
    async suggestCompletion(
        file: string,
        position: vscode.Position,
        context: string
    ): Promise<string> {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º CursorAI Tab API –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
        const suggestions = await CursorAPI.getTabCompletions({
            file,
            position,
            context
        });
        
        return suggestions.best;
    }
}
```

## 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–¥–µ—Ä–∂–µ–∫ - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```typescript
// src/optimization/prompt-cache.ts
export class PromptCache {
    private cache = new LRU<string, CacheEntry>({ max: 1000 });
    
    /**
     * –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
     */
    async getOrCompute<T>(
        promptKey: string,
        computeFn: () => Promise<T>,
        ttl: number = 3600000 // 1 —á–∞—Å
    ): Promise<T> {
        const cached = this.cache.get(promptKey);
        if (cached && !cached.isExpired()) {
            console.log('‚úÖ Cache HIT - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ $' + cached.estimatedCost);
            return cached.result as T;
        }
        
        const result = await computeFn();
        this.cache.set(promptKey, {
            result,
            timestamp: Date.now(),
            ttl,
            estimatedCost: this.estimateCost(result)
        });
        
        return result;
    }
}
```

### –£–º–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
```typescript
// src/optimization/model-selector.ts
export class SmartModelSelector {
    /**
     * –í—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–¥–∞—á–∏
     */
    selectModel(task: Task, context: ProjectContext): ModelChoice {
        const complexity = this.estimateComplexity(task, context);
        const budget = this.getRemainingBudget();
        
        // –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏ ‚Üí –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
        if (complexity < 0.3) {
            return {
                provider: 'ollama',
                model: 'codellama:7b',
                estimatedCost: 0,
                reasoning: '–ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å'
            };
        }
        
        // –°—Ä–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚Üí –æ–±–ª–∞—á–Ω—ã–µ API (–¥–µ—à–µ–≤–æ)
        if (complexity < 0.7 && budget > 0.10) {
            return {
                provider: 'openai',
                model: 'gpt-3.5-turbo',
                estimatedCost: 0.02,
                reasoning: '–°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å - OpenAI GPT-3.5'
            };
        }
        
        // –°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ ‚Üí CursorAI (Pro –ø–ª–∞–Ω)
        if (this.canUseCursorAI(task)) {
            return {
                provider: 'cursor',
                model: 'auto',
                estimatedCost: 0.05, // –í —Ä–∞–º–∫–∞—Ö Pro –ø–ª–∞–Ω–∞
                reasoning: '–°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º CursorAI'
            };
        }
        
        // Fallback ‚Üí –æ–±–ª–∞—á–Ω—ã–µ API
        return {
            provider: 'openai',
            model: 'gpt-4-turbo',
            estimatedCost: 0.10,
            reasoning: 'Fallback –Ω–∞ GPT-4'
        };
    }
    
    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CursorAI
     */
    private canUseCursorAI(task: Task): boolean {
        const settings = this.getSettings();
        const taskType = task.type;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if (!settings.useCursorAIFor.includes(taskType)) {
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã Pro –ø–ª–∞–Ω–∞
        if (this.cursorUsageToday > settings.maxCursorCallsPerDay) {
            return false;
        }
        
        return true;
    }
}
```

### Batching –∑–∞–ø—Ä–æ—Å–æ–≤
```typescript
// src/optimization/request-batcher.ts
export class RequestBatcher {
    private pendingRequests: BatchRequest[] = [];
    private batchTimer?: NodeJS.Timeout;
    
    /**
     * –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ batch
     */
    async addRequest(request: LLMRequest): Promise<LLMResponse> {
        return new Promise((resolve) => {
            this.pendingRequests.push({ request, resolve });
            
            // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å batch —á–µ—Ä–µ–∑ 100ms
            if (!this.batchTimer) {
                this.batchTimer = setTimeout(() => {
                    this.processBatch();
                }, 100);
            }
        });
    }
    
    /**
     * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å batch –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑
     */
    private async processBatch(): Promise<void> {
        if (this.pendingRequests.length === 0) return;
        
        const batch = this.pendingRequests;
        this.pendingRequests = [];
        this.batchTimer = undefined;
        
        console.log(`üì¶ Batching ${batch.length} –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–∏–Ω`);
        
        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–æ–º–ø—Ç—ã –≤ –æ–¥–∏–Ω –¥–ª–∏–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
        const combinedPrompt = this.combinePrompts(batch.map(b => b.request));
        
        // –û–¥–∏–Ω –≤—ã–∑–æ–≤ –≤–º–µ—Å—Ç–æ N –≤—ã–∑–æ–≤–æ–≤
        const response = await this.callLLM(combinedPrompt);
        
        // –†–∞–∑–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        const results = this.splitResults(response, batch.length);
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        batch.forEach((b, i) => b.resolve(results[i]));
        
        // –≠–∫–æ–Ω–æ–º–∏—è: (N-1) –∑–∞–ø—Ä–æ—Å–æ–≤ * —Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
        const saved = (batch.length - 1) * 0.02;
        console.log(`üí∞ –°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ $${saved.toFixed(2)}`);
    }
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞—Ç—Ä–∞—Ç
```typescript
// src/optimization/cost-monitor.ts
export class CostMonitor {
    private totalCost: number = 0;
    private costsByProvider: Map<string, number> = new Map();
    private costsByAgent: Map<string, number> = new Map();
    
    /**
     * –ó–∞–ø–∏—Å–∞—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –≤—ã–∑–æ–≤
     */
    trackCall(
        provider: string,
        agentId: string,
        cost: number,
        tokens: number
    ): void {
        this.totalCost += cost;
        
        // –ü–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É
        const providerCost = this.costsByProvider.get(provider) || 0;
        this.costsByProvider.set(provider, providerCost + cost);
        
        // –ü–æ –∞–≥–µ–Ω—Ç—É
        const agentCost = this.costsByAgent.get(agentId) || 0;
        this.costsByAgent.set(agentId, agentCost + cost);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±—é–¥–∂–µ—Ç
        this.checkBudgetLimits();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        this.updateCostDisplay();
    }
    
    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –±—é–¥–∂–µ—Ç–∞
     */
    private checkBudgetLimits(): void {
        const settings = this.getSettings();
        const monthlyBudget = settings.maxMonthlyBudget;
        const monthlyCost = this.getMonthlyCost();
        
        if (monthlyCost >= monthlyBudget * 0.9) {
            vscode.window.showWarningMessage(
                `‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 90% –º–µ—Å—è—á–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ ($${monthlyCost.toFixed(2)} / $${monthlyBudget})`
            );
        }
        
        if (monthlyCost >= monthlyBudget) {
            vscode.window.showErrorMessage(
                `üö´ –ú–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω! –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏.`
            );
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
            this.switchToLocalModelsOnly();
        }
    }
    
    /**
     * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∑–∞—Ç—Ä–∞—Ç–∞–º
     */
    getStatistics(): CostStatistics {
        return {
            total: this.totalCost,
            today: this.getDailyCost(),
            thisMonth: this.getMonthlyCost(),
            byProvider: Object.fromEntries(this.costsByProvider),
            byAgent: Object.fromEntries(this.costsByAgent),
            savings: this.calculateSavings()
        };
    }
    
    /**
     * –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —ç–∫–æ–Ω–æ–º–∏—é –æ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
     */
    private calculateSavings(): CostSavings {
        return {
            fromCaching: this.cacheSavings,
            fromBatching: this.batchSavings,
            fromLocalModels: this.localModelSavings,
            total: this.cacheSavings + this.batchSavings + this.localModelSavings
        };
    }
}
```

## 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```json
{
    "cursor-autonomous.integration.cursorai": {
        "enabled": true,
        "useChatForConsolidation": true,
        "useComposerForEditing": true,
        "useTabForCompletions": false,
        "maxCallsPerDay": 100
    },
    
    "cursor-autonomous.tasks.userInput": {
        "enableContextMenu": true,
        "enableCommandPalette": true,
        "enableStatusBar": true,
        "defaultPriority": "medium",
        "showNotifications": true
    },
    
    "cursor-autonomous.costOptimization": {
        "enabled": true,
        "preferLocalModels": true,
        "maxMonthlyBudget": 50,
        "useCursorAIFor": [
            "consolidation",
            "complex-refactoring",
            "file-editing",
            "multi-file-changes"
        ],
        "caching": {
            "enabled": true,
            "ttl": 3600000,
            "maxSize": 1000
        },
        "batching": {
            "enabled": true,
            "delay": 100,
            "maxBatchSize": 10
        },
        "alertThreshold": 0.9,
        "switchToLocalOnBudgetExceeded": true
    },
    
    "cursor-autonomous.monitoring": {
        "showCostInStatusBar": true,
        "showDailyReport": true,
        "logAllCalls": true
    }
}
```

## 6. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CursorAI

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
‚úÖ **–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - CursorAI –º–æ–¥–µ–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –æ–±—É—á–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–æ–º
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - CursorAI Composer –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
‚úÖ **–í—Å—Ç—Ä–æ–µ–Ω–Ω–æ—Å—Ç—å** - –Ω–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDE
‚úÖ **–ë—É–¥—É—â–µ–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π CursorAI

### –î–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞—Ç—Ä–∞—Ç:
‚úÖ **80% –∑–∞–¥–∞—á** - –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
‚úÖ **15% –∑–∞–¥–∞—á** - –¥–µ—à–µ–≤—ã–µ –æ–±–ª–∞—á–Ω—ã–µ API ($5-10/–º–µ—Å—è—Ü)
‚úÖ **5% –∑–∞–¥–∞—á** - CursorAI Pro (–≤ —Ä–∞–º–∫–∞—Ö –ª–∏–º–∏—Ç–æ–≤ –ø–ª–∞–Ω–∞)
‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–æ–∫—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ 30-50%
‚úÖ **Batching** - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, —ç–∫–æ–Ω–æ–º–∏—Ç 20-30%
‚úÖ **–£–º–Ω—ã–π –≤—ã–±–æ—Ä** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å

### –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –∑–∞—Ç—Ä–∞—Ç:
- **–ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π**: $100-150/–º–µ—Å—è—Ü
- **–° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏**: $10-20/–º–µ—Å—è—Ü (–∏–ª–∏ –≤–æ–æ–±—â–µ $0 –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö)
- **–≠–∫–æ–Ω–æ–º–∏—è**: 80-90%
