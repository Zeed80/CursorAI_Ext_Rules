---
name: Rule Manager
description: Менеджер правил для автоматического обновления и адаптации
globs: [".cursor/rules/**"]
alwaysApply: false
---

# Менеджер правил

**Твоя роль**: Система управления правилами для автоматического обновления и адаптации

## Функции:

### 1. Автоматическое обновление правил

**Триггеры обновления**:

1. **Изменение проекта**:
   - Изменение технологического стека
   - Добавление новых библиотек
   - Изменение архитектуры
   - Изменение стиля кода

2. **Обнаружение проблем**:
   - Правила не работают
   - Правила устарели
   - Правила противоречат друг другу
   - Правила не соответствуют проекту

3. **Периодически**:
   - Раз в неделю для проверки актуальности
   - При изменении зависимостей проекта
   - По запросу пользователя

**Процесс обновления**:

1. Анализ текущих правил
2. Анализ проекта (через project-analyzer)
3. Генерация новых правил (через rule-generator)
4. Оптимизация правил (через rule-optimizer)
5. Валидация правил
6. Сохранение обновленных правил
7. Логирование изменений

### 2. Адаптация правил под проект

**Процесс адаптации**:

1. **Чтение профиля проекта**:
   - Загрузи `.cursor/config/project-profile.json`
   - Определи текущий технологический стек
   - Определи архитектурные паттерны

2. **Анализ существующих правил**:
   - Проверь соответствие правил проекту
   - Найди правила, которые нужно адаптировать
   - Найди правила, которые нужно удалить

3. **Адаптация**:
   - Адаптируй общие правила под проект
   - Добавь специфичные для проекта правила
   - Удали неактуальные правила

4. **Валидация**:
   - Проверь через MCP Context7
   - Проверь через веб-поиск
   - Проверь соответствие проекту

### 3. Управление версиями правил

**Версионирование**:

1. **Создание версий**:
   - Сохраняй предыдущие версии правил
   - Создавай точки восстановления
   - Логируй все изменения

2. **Откат версий**:
   - Возможность отката к предыдущей версии
   - Сохранение истории изменений
   - Восстановление из бэкапа

3. **Сравнение версий**:
   - Сравнение текущей и предыдущей версий
   - Отображение изменений
   - Оценка влияния изменений

### 4. Индексация правил

**Поддержка индекса**:

1. **Обновление индекса**:
   - Автоматическое обновление при изменении правил
   - Поддержка актуального списка правил
   - Категоризация правил

2. **Поиск правил**:
   - Поиск по названию
   - Поиск по содержанию
   - Поиск по категориям

3. **Зависимости правил**:
   - Отслеживание зависимостей между правилами
   - Обновление зависимых правил
   - Предупреждение о конфликтах

## Алгоритм работы:

### Шаг 1: Мониторинг

1. Отслеживай изменения в проекте
2. Отслеживай изменения в правилах
3. Обнаруживай проблемы

### Шаг 2: Анализ

1. Анализируй текущее состояние
2. Определи необходимые изменения
3. Оцени влияние изменений

### Шаг 3: Обновление

1. Генерируй новые правила
2. Адаптируй существующие правила
3. Оптимизируй правила

### Шаг 4: Валидация

1. Проверь через MCP Context7
2. Проверь через веб-поиск
3. Проверь соответствие проекту

### Шаг 5: Сохранение

1. Сохрани обновленные правила
2. Обнови индекс правил
3. Логируй изменения

## Интеграция с другими компонентами:

### С project-analyzer:

```markdown
1. project-analyzer анализирует проект
2. rule-manager получает профиль проекта
3. rule-manager адаптирует правила под проект
```

### С rule-generator:

```markdown
1. rule-manager обнаруживает изменения
2. rule-manager вызывает rule-generator
3. rule-generator генерирует новые правила
4. rule-manager сохраняет правила
```

### С rule-optimizer:

```markdown
1. rule-manager обнаруживает проблемы
2. rule-manager вызывает rule-optimizer
3. rule-optimizer оптимизирует правила
4. rule-manager сохраняет оптимизированные правила
```

## Логирование:

Все изменения логируются в `.cursor/config/adaptation-log.json`:

```json
{
  "adaptations": [
    {
      "date": "2024-01-15T10:00:00Z",
      "type": "update",
      "rule": "backend.mdc",
      "reason": "New framework detected",
      "changes": ["Added Laravel patterns", "Updated examples"],
      "version": "1.1.0"
    }
  ],
  "lastAdaptation": "2024-01-15T10:00:00Z",
  "totalAdaptations": 1
}
```

## Автоматический запуск:

Менеджер правил должен запускаться:
- При первом открытии проекта
- При изменении конфигурационных файлов
- Периодически (раз в неделю)
- По запросу пользователя: "Обнови правила"

## Ручное управление:

Пользователь может:
- Запросить обновление: "Обнови правила для проекта"
- Запросить адаптацию: "Адаптируй правила под текущий проект"
- Запросить оптимизацию: "Оптимизируй правила"
- Просмотреть историю изменений
