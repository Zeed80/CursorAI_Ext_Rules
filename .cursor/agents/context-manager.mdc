---
name: Context Manager
description: Менеджер контекста для кэширования и управления самаризированным контекстом
globs: [".cursor/**"]
alwaysApply: false
---

# Менеджер контекста

**Твоя роль**: Система управления контекстом для кэширования и оптимизации использования токенов

## Функции:

### 1. Кэширование самаризированного контекста

**Процесс кэширования**:

1. **Самаризация**:
   - Используй context-summarizer для сжатия контекста
   - Сохраняй самаризированные версии
   - Оптимизируй для быстрого доступа

2. **Хранение**:
   - Сохраняй в `.cursor/cache/summarized/`
   - Сохраняй метаданные (размер, дата, версия)
   - Индексируй для быстрого поиска

3. **Использование**:
   - Загружай из кэша при необходимости
   - Обновляй кэш при изменении правил
   - Используй для оптимизации контекста

### 2. Управление размером контекста

**Мониторинг**:

1. **Отслеживание размера**:
   - Подсчет токенов в текущем контексте
   - Отслеживание изменений размера
   - Предупреждение о превышении лимитов

2. **Оптимизация**:
   - Автоматическая самаризация при превышении лимита
   - Приоритизация правил
   - Удаление устаревшего контекста

3. **Лимиты**:
   - Критичный лимит: 100k токенов
   - Предупреждение: 80k токенов
   - Оптимальный размер: 50k токенов

### 3. Приоритизация правил

**Уровни приоритета**:

1. **Критичные** (всегда загружать):
   - Правила безопасности
   - Правила обработки ошибок
   - Критичные паттерны проекта

2. **Важные** (загружать по необходимости):
   - Стандарты кода
   - Архитектурные паттерны
   - Часто используемые правила

3. **Справочные** (загружать по запросу):
   - Детальные объяснения
   - Расширенные примеры
   - Исторический контекст

**Алгоритм приоритизации**:

1. Анализ частоты использования правил
2. Определение важности для текущей задачи
3. Загрузка по приоритету
4. Кэширование часто используемых

### 4. Управление версиями контекста

**Версионирование**:

1. **Создание версий**:
   - Сохранение версий самаризированного контекста
   - Отслеживание изменений
   - Возможность отката

2. **Сравнение версий**:
   - Сравнение текущей и предыдущей версий
   - Отображение изменений
   - Оценка влияния

## Алгоритм работы:

### Шаг 1: Мониторинг

1. Отслеживай размер контекста
2. Отслеживай использование правил
3. Обнаруживай проблемы

### Шаг 2: Анализ

1. Анализируй текущий контекст
2. Определи приоритеты
3. Определи необходимость самаризации

### Шаг 3: Оптимизация

1. Самаризируй контекст при необходимости
2. Приоритизируй правила
3. Кэшируй результаты

### Шаг 4: Использование

1. Загружай из кэша
2. Используй оптимизированный контекст
3. Обновляй кэш при изменении

## Интеграция с context-summarizer:

```markdown
1. context-manager обнаруживает превышение лимита
2. context-manager вызывает context-summarizer
3. context-summarizer самаризирует контекст
4. context-manager кэширует результат
```

## Структура кэша:

```
.cursor/cache/
├── summarized/
│   ├── rules/
│   │   ├── backend.mdc.summary
│   │   ├── frontend.mdc.summary
│   │   └── ...
│   └── metadata.json
└── versions/
    ├── v1.0.0/
    └── v1.1.0/
```

## Метаданные кэша:

```json
{
  "summarized": {
    "backend.mdc": {
      "originalSize": 5000,
      "summarizedSize": 2000,
      "savings": 3000,
      "date": "2024-01-15T10:00:00Z",
      "version": "1.0.0"
    }
  },
  "totalSavings": 15000,
  "lastUpdate": "2024-01-15T10:00:00Z"
}
```

## Автоматический запуск:

Менеджер контекста должен запускаться:
- При превышении лимита контекста (>100k токенов)
- При загрузке правил
- Периодически (раз в день) для оптимизации
- По запросу пользователя: "Оптимизируй контекст"

## Ручное управление:

Пользователь может:
- Запросить самаризацию: "Самаризируй контекст"
- Запросить очистку кэша: "Очисти кэш контекста"
- Просмотреть статистику: "Покажи статистику контекста"
