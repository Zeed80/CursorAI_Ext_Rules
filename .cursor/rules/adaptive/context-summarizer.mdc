---
name: Context Summarizer
description: Система сжатия контекста для оптимизации использования токенов
globs: ["**/*"]
alwaysApply: false
---

# Самаризатор контекста

**Твоя роль**: Система сжатия контекста для оптимизации использования токенов

## Процесс:

### 1. Анализ контекста

**Определи**:
- Размер текущего контекста (количество токенов)
- Важность каждого фрагмента (критично, важно, справочно, устаревшее)
- Дублирующуюся информацию
- Устаревшую информацию

**Методы анализа**:
- Подсчет токенов в правилах
- Анализ частоты использования правил
- Определение зависимостей между правилами
- Выявление повторяющихся концепций

### 2. Самаризация

**Принципы сжатия**:

1. **Сожми текст, сохраняя ключевые моменты**:
   - Удали избыточные объяснения
   - Оставь только суть
   - Сохрани примеры кода (они критичны)

2. **Удали дубликаты**:
   - Объедини повторяющиеся правила
   - Создай ссылки на общие правила
   - Удали идентичные примеры

3. **Объедини похожие правила**:
   - Группируй связанные правила
   - Создай иерархию правил
   - Используй ссылки для деталей

4. **Сохрани примеры кода**:
   - Примеры кода критичны для понимания
   - Сохраняй их полностью
   - Используй краткие комментарии

### 3. Приоритизация

**Уровни приоритета**:

1. **Критичные правила** (всегда полный текст):
   - Правила безопасности
   - Правила обработки ошибок
   - Критичные паттерны проекта
   - Максимальная длина: 3000 токенов

2. **Важные правила** (сжатый текст):
   - Стандарты кода
   - Архитектурные паттерны
   - Максимальная длина: 2000 токенов

3. **Справочные правила** (ссылки):
   - Детальные объяснения
   - Расширенные примеры
   - Формат: ссылка на полное правило

4. **Устаревшие правила** (архив):
   - Правила для старых версий
   - Неиспользуемые паттерны
   - Переместить в `.cursor/rules/archive/`

## Правила сжатия:

### Максимальные длины:

- Критичные правила: 3000 токенов
- Важные правила: 2000 токенов
- Справочные правила: 500 токенов (только ссылки)
- Примеры кода: сохранять полностью (не сжимать)

### Что сохранять полностью:

- Примеры кода (критичны для понимания)
- Ключевые концепции (определения, принципы)
- Синтаксис и API (точные примеры)
- Правила безопасности (полный текст)

### Что сжимать:

- Детальные объяснения → краткое описание
- Повторяющаяся информация → ссылки
- Расширенные примеры → один ключевой пример
- Исторический контекст → удалить

## Формат самаризации:

### До (5000 токенов):

```markdown
# Детальное правило с множеством примеров

## Введение
[Длинное введение с историей и контекстом]

## Основные концепции
[Детальное объяснение концепций]

## Примеры
[Множество примеров кода]

## Дополнительные примеры
[Еще больше примеров]

## Заключение
[Длинное заключение]
```

### После (2000 токенов):

```markdown
# Сжатое правило

## Ключевые концепции
[Краткое описание сути]

## Основной пример
[Один ключевой пример кода]

## Дополнительная информация
- [Ссылка на детальное правило: rule-name.mdc]
- [Ссылка на примеры: examples.md]

## Важные моменты
- Пункт 1
- Пункт 2
- Пункт 3
```

## Алгоритм самаризации:

### Шаг 1: Анализ

1. Прочитай правило
2. Определи размер (токены)
3. Определи важность
4. Найди дубликаты

### Шаг 2: Сжатие

1. Удали избыточные объяснения
2. Оставь только ключевые моменты
3. Сохрани примеры кода
4. Создай ссылки на детали

### Шаг 3: Оптимизация

1. Объедини похожие правила
2. Создай иерархию
3. Оптимизируй структуру
4. Проверь размер

### Шаг 4: Валидация

1. Проверь, что смысл сохранен
2. Проверь, что примеры доступны
3. Проверь размер (не превышает лимит)
4. Проверь ссылки (работают ли)

## Примеры самаризации:

### Пример 1: Правило обработки ошибок

**До** (3000 токенов):
```markdown
# Обработка ошибок

## Введение
Обработка ошибок - это критически важная часть разработки...

## Типы ошибок
[Детальное описание всех типов]

## Примеры для PHP
[10 примеров кода]

## Примеры для JavaScript
[10 примеров кода]

## Примеры для Python
[10 примеров кода]

## Best practices
[Длинный список]
```

**После** (1500 токенов):
```markdown
# Обработка ошибок

## Принципы
- Всегда обрабатывай ошибки
- Логируй все исключения
- Предоставляй информативные сообщения

## Основной пример (PHP)
```php
try {
    // код
} catch (Exception $e) {
    error_log($e->getMessage());
    throw $e;
}
```

## Дополнительные примеры
- [PHP примеры: error-handling-php.md]
- [JavaScript примеры: error-handling-js.md]
- [Python примеры: error-handling-py.md]

## Best practices
- Используй try-catch для критических операций
- Логируй с контекстом
- Не раскрывай внутренние детали пользователю
```

### Пример 2: Правило безопасности

**До** (4000 токенов):
```markdown
# Безопасность SQL запросов

[Очень длинное объяснение всех аспектов безопасности]
```

**После** (2000 токенов):
```markdown
# Безопасность SQL запросов

## Критичное правило
НИКОГДА не используй прямую интерполяцию строк в SQL.

## Правильный способ
```php
$stmt = $pdo->prepare("SELECT * FROM books WHERE title = ?");
$stmt->execute([$title]);
```

## Дополнительная информация
- [Детальное руководство: sql-security-guide.md]
- [Примеры атак: sql-injection-examples.md]
```

## Автоматический запуск:

Самаризатор должен запускаться:
- При превышении лимита контекста (например, >100k токенов)
- При добавлении новых правил
- По запросу пользователя: "Оптимизируй контекст"
- Периодически (раз в неделю) для оптимизации

## Кэширование:

1. Сохраняй самаризированные версии в `.cursor/cache/summarized/`
2. Используй кэш для быстрого доступа
3. Обновляй кэш при изменении правил
4. Храни метаданные (размер, дата самаризации)
